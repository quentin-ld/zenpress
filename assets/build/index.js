(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.domReady;var s=e.n(t);const n=window.wp.element,r=window.wp.apiFetch;var a=e.n(r);const o=window.wp.data,i=window.wp.notices,c=window.wp.i18n,l=[{key:"autoptimize",path:"/zenpress/v1/autoconfig/autoptimize",successMessage:(0,c.__)("Autoptimize configured.","zenpress"),errorMessage:(0,c.__)("Autoptimize setup failed. Is Autoptimize installed and active?","zenpress"),buttonLabel:(0,c.__)("Set up Autoptimize","zenpress"),helpText:(0,c.__)("Apply recommended settings: minify JS and CSS, combine CSS, static file caching, 404 fallbacks.","zenpress")},{key:"cache_enabler",path:"/zenpress/v1/autoconfig/cache-enabler",successMessage:(0,c.__)("Cache Enabler configured.","zenpress"),errorMessage:(0,c.__)("Cache Enabler setup failed. Is Cache Enabler installed and active?","zenpress"),buttonLabel:(0,c.__)("Set up Cache Enabler","zenpress"),helpText:(0,c.__)("Apply recommended settings: clear cache on content changes, WebP, compression, minify HTML.","zenpress")},{key:"sqlite_object_cache",path:"/zenpress/v1/autoconfig/sqlite-object-cache",successMessage:(0,c.__)("SQLite Object Cache configured.","zenpress"),errorMessage:(0,c.__)("SQLite Object Cache setup failed. Is it installed and active?","zenpress"),buttonLabel:(0,c.__)("Set up SQLite Object Cache","zenpress"),helpText:(0,c.__)('Apply recommended settings. Enable "Use APCu" in the plugin if available.',"zenpress")}],p=["core","gutenberg","woocommerce","ads-blocker","tools"];function d(e){return null==e||"string"!=typeof e?e:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}const u=window.wp.components,b=window.ReactJSXRuntime,h=()=>{const{removeNotice:e}=(0,o.useDispatch)(i.store),t=(0,o.useSelect)(e=>e(i.store).getNotices(),[]);return t&&0!==t.length?(0,b.jsx)(u.NoticeList,{notices:t,onRemove:e}):null},g=(0,n.createContext)(),f=({selectedTabId:e,onSelect:t,orientation:s="horizontal",children:r})=>{const[a,o]=(0,n.useState)(),i=(0,n.useRef)(null),c=void 0!==e?e:a;return(0,b.jsx)(g.Provider,{value:{selectedTabId:c,onSelect:s=>{void 0===e&&o(s),t?.(s)},orientation:s,getOrderedTabIds:()=>i.current?Array.from(i.current.querySelectorAll('[role="tab"]')).map(e=>{const t=e.getAttribute("id");return t?t.replace("zenpress-tab-",""):null}).filter(Boolean):[],tabListRef:i},children:(0,b.jsx)("div",{className:`zenpress-tabs zenpress-tabs--${s}`,children:r})})};f.TabList=({children:e})=>{const{orientation:t,tabListRef:s}=(0,n.useContext)(g);return(0,b.jsx)("div",{ref:s,className:`zenpress-tabs__list zenpress-tabs__list--${t}`,role:"tablist","aria-orientation":t,children:e})},f.Tab=({tabId:e,title:t,className:s="",children:r})=>{const{selectedTabId:a,onSelect:o,orientation:i,getOrderedTabIds:c}=(0,n.useContext)(g),l=a===e,p=(0,n.useRef)(null);return(0,b.jsx)("button",{ref:p,className:`zenpress-tabs__tab ${l?"zenpress-tabs__tab--is-active":""} ${s}`.trim(),role:"tab","aria-selected":l,"aria-controls":`zenpress-tab-panel-${e}`,id:`zenpress-tab-${e}`,tabIndex:l?0:-1,onClick:()=>o(e),onKeyDown:t=>{const s=c();if(!s||0===s.length)return;const n=s.indexOf(e);if(-1===n)return;let r=n;if("vertical"===i?"ArrowDown"===t.key?(t.preventDefault(),r=n<s.length-1?n+1:0):"ArrowUp"===t.key&&(t.preventDefault(),r=n>0?n-1:s.length-1):"ArrowRight"===t.key?(t.preventDefault(),r=n<s.length-1?n+1:0):"ArrowLeft"===t.key&&(t.preventDefault(),r=n>0?n-1:s.length-1),"Home"===t.key?(t.preventDefault(),r=0):"End"===t.key&&(t.preventDefault(),r=s.length-1)," "===t.key||"Enter"===t.key)return t.preventDefault(),void o(e);if(r!==n&&r>=0&&r<s.length){const e=s[r],t=document.getElementById(`zenpress-tab-${e}`);t&&(t.focus(),o(e))}},onFocus:()=>{l||o(e)},children:t||r})},f.TabPanel=({tabId:e,children:t})=>{const{selectedTabId:s}=(0,n.useContext)(g),r=(0,n.useRef)(null),a=s===e;return(0,n.useEffect)(()=>{a&&r.current&&(0===r.current.querySelectorAll('a[href], button:not([disabled]), [tabindex]:not([tabindex="-1"]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])').length?r.current.setAttribute("tabindex","0"):r.current.removeAttribute("tabindex"))},[a]),a?(0,b.jsx)("div",{ref:r,className:"zenpress-tabs__panel",role:"tabpanel",id:`zenpress-tab-panel-${e}`,"aria-labelledby":`zenpress-tab-${e}`,children:t}):(0,b.jsx)("div",{className:"zenpress-tabs__panel",role:"tabpanel",id:`zenpress-tab-panel-${e}`,"aria-labelledby":`zenpress-tab-${e}`,hidden:!0,children:t})};const m=({onClick:e,isBusy:t})=>(0,b.jsx)(u.Button,{variant:"primary",onClick:e,isBusy:t,__next40pxDefaultSize:!0,children:(0,c.__)("Save","zenpress")});function y({onEnableAll:e,onDisableAll:t,onSave:s,isSaving:n}){return(0,b.jsxs)("div",{className:"zenpress-actions",children:[(0,b.jsxs)("div",{className:"zenpress-actions-bulk",children:[(0,b.jsx)(u.Button,{variant:"tertiary",onClick:e,__next40pxDefaultSize:!0,children:(0,c.__)("Enable all","zenpress")}),(0,b.jsx)(u.Button,{isDestructive:!0,onClick:t,__next40pxDefaultSize:!0,children:(0,c.__)("Disable all","zenpress")})]}),(0,b.jsx)(m,{onClick:s,isBusy:n})]})}function _(){const e="undefined"!=typeof window?window.zenpressIntegrationsActive:null;return!e||"object"!=typeof e||Array.isArray(e)?{}:e}const z=({label:e,value:t,onChange:s,help:r})=>{const a=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>((e,t)=>{if(!e)return;const s=s=>{if("Enter"===s.key){const n=e.querySelector('input[type="checkbox"]'),r=e.ownerDocument||document;n&&(r.activeElement===n||e.contains(r.activeElement))&&(s.preventDefault(),s.stopPropagation(),t())}};return e.addEventListener("keydown",s),()=>{e.removeEventListener("keydown",s)}})(a.current,s),[s]),(0,b.jsx)("div",{ref:a,children:(0,b.jsx)(u.ToggleControl,{label:e,checked:t,onChange:s,help:r,__nextHasNoMarginBottom:!0})})};function v({subcategory:e,items:t,onToggle:s}){const n=e.toLowerCase().replace(/\s+/g,"-");return(0,b.jsxs)("div",{className:`zenpress-subcategory zenpress-subcategory-${n}`,children:[(0,b.jsx)("hr",{}),(0,b.jsx)("h3",{children:d(e)}),t.map(({name:e,data:t})=>(0,b.jsx)(z,{label:t.title||e,value:t?.["enable-snippet"]||!1,onChange:()=>s(e),help:t.description||""},e))]},e)}function x({integrationKey:e,buttonLabel:t,helpText:s,onClick:n,busyKey:r}){const a=r===e;return(0,b.jsxs)("div",{className:"zenpress-autoconfig-actions",children:[(0,b.jsx)(u.Button,{variant:"secondary",onClick:n,disabled:null!==r,__next40pxDefaultSize:!0,children:a?(0,c.__)("Applyingâ€¦","zenpress"):t}),(0,b.jsx)("p",{className:"zenpress-autoconfig-help",children:s})]})}function j({adminBarEnabled:e,setAdminBarEnabled:t,autoconfigBusy:s,getAutoconfigHandler:n}){return(0,b.jsxs)("div",{className:"zenpress-subcategory zenpress-subcategory-integrations",children:[(0,b.jsx)("hr",{}),(0,b.jsx)("h3",{children:(0,c.__)("Integrations","zenpress")}),(0,b.jsx)(z,{label:(0,c.__)("Show cache actions in admin bar","zenpress"),value:e,onChange:()=>t(!e),help:(0,c.__)('Adds a ZenPress menu to the admin bar with "Clear all caches" and options for each active cache (page, static files, object cache). Only appears when Cache Enabler, Autoptimize, or SQLite Object Cache is active. Hides those plugins\' own admin bar buttons.',"zenpress")}),l.filter(e=>_()[e.key]).map(e=>(0,b.jsx)(x,{integrationKey:e.key,buttonLabel:e.buttonLabel,helpText:e.helpText,onClick:n(e.key),busyKey:s},e.key))]})}function w({category:e,groupedSnippets:t,onToggle:s,showIntegrations:n=!1,adminBarEnabled:r,setAdminBarEnabled:a,autoconfigBusy:o,getAutoconfigHandler:i}){const c=Object.keys(t[e]||{}).sort();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{children:d(e)}),c.map(n=>(0,b.jsx)(v,{subcategory:n,items:t[e]?.[n]??[],onToggle:s},n)),n&&Object.values(_()).some(Boolean)&&(0,b.jsx)(j,{adminBarEnabled:r,setAdminBarEnabled:a,autoconfigBusy:o,getAutoconfigHandler:i})]})}function S({icon:e,title:t,description:s,presetId:n,onEnable:r}){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("hr",{}),(0,b.jsxs)("h3",{children:[e," ",t]}),(0,b.jsx)("p",{children:s}),(0,b.jsx)(u.Button,{variant:"secondary",onClick:()=>r(n),__next40pxDefaultSize:!0,children:(0,c.__)("Apply preset","zenpress")})]})}const E=[{id:"corporate-website",icon:"ðŸ–¼ï¸",title:(0,c.__)("Corporate website","zenpress"),description:(0,c.__)("For business sites and portfolios. Focuses on security, performance, and removing unused features like RSS and author archives.","zenpress")},{id:"blog",icon:"ðŸ“°",title:(0,c.__)("Blog","zenpress"),description:(0,c.__)("For content-focused blogs. Keeps RSS and other blog features while improving performance and security.","zenpress")},{id:"ecommerce",icon:"ðŸ›’",title:(0,c.__)("E-commerce","zenpress"),description:(0,c.__)("For WooCommerce stores. Performance and security plus WooCommerce optimizations for faster checkout.","zenpress")}];function A({onEnablePreset:e}){return(0,b.jsx)("div",{className:"zenpress-presets",children:(0,b.jsxs)("div",{className:"zenpress-presets-description",children:[(0,b.jsx)("h2",{children:(0,c.__)("Choose a preset","zenpress")}),(0,b.jsx)("p",{children:(0,c.__)("Not sure what to enable? Choose a preset that matches your site. Each preset turns on a set of features for that type of site.","zenpress")}),E.map(t=>(0,b.jsx)(S,{icon:t.icon,title:t.title,description:t.description,presetId:t.id,onEnable:e},t.id))]})})}const C=()=>{const{snippets:e,setSnippets:t,adminBarEnabled:s,setAdminBarEnabled:r,saveSettings:u,isSaving:g}=(()=>{const[e,t]=(0,n.useState)({}),[s,r]=(0,n.useState)(!1),[l,p]=(0,n.useState)(!1),{createSuccessNotice:d,createErrorNotice:u}=(0,o.useDispatch)(i.store);return(0,n.useEffect)(()=>{let e=!1;return(async()=>{try{const s=await a()({path:"/wp/v2/settings"});if(e)return;const n=Array.isArray(s?.zenpress_active_snippets)?s.zenpress_active_snippets:[],o=window?.zenpressSnippetsMeta,i=o&&"object"==typeof o&&!Array.isArray(o)?o:{},c={};Object.keys(i).forEach(e=>{c[e]={...i[e],"enable-snippet":n.includes(e)}}),t(c),r(!0===s?.zenpress_admin_bar_enabled)}catch{e||u((0,c.__)("Settings could not be loaded. Refresh the page.","zenpress"))}})(),()=>{e=!0}},[u]),{snippets:e,setSnippets:t,adminBarEnabled:s,setAdminBarEnabled:r,saveSettings:async()=>{p(!0);const t=Object.keys(e).filter(t=>e[t]?.["enable-snippet"]);try{await a()({path:"/wp/v2/settings",method:"POST",data:{zenpress_active_snippets:t,zenpress_admin_bar_enabled:s}}),d((0,c.__)("Settings saved.","zenpress"))}catch{u((0,c.__)("Settings could not be saved. Try again.","zenpress"))}finally{p(!1)}},isSaving:l}})(),{autoconfigBusy:m,getHandler:_}=function(){const[e,t]=(0,n.useState)(null),{createSuccessNotice:s,createErrorNotice:r}=(0,o.useDispatch)(i.store),c=async(e,n,o,i)=>{if("string"==typeof n&&n.startsWith("/")){t(e);try{const e=await a()({path:n,method:"POST"});s(e?.message||o)}catch{r(i)}finally{t(null)}}else r(i)};return{autoconfigBusy:e,runAutoconfig:c,getHandler:e=>{const t=l.find(t=>t.key===e);return t?()=>c(t.key,t.path,t.successMessage,t.errorMessage):()=>{}}}}(),[z,v]=(0,n.useState)(),{grouped:x,sortedCategories:j}=(0,n.useMemo)(()=>function(e){const t={};if(!e||"object"!=typeof e||Array.isArray(e))return{grouped:t,sortedCategories:[]};Object.keys(e).forEach(s=>{const n=e[s],r=(n?.category||(0,c.__)("Uncategorized","zenpress")).toLowerCase(),a=(n?.subcategory||(0,c.__)("Uncategorized","zenpress")).toLowerCase();t[r]||(t[r]={}),t[r][a]||(t[r][a]=[]),t[r][a].push({name:s,data:n})});const s=Object.keys(t).sort((e,t)=>{const s=p.indexOf(e.toLowerCase()),n=p.indexOf(t.toLowerCase());return-1!==s&&-1!==n?s-n:-1!==s?-1:-1!==n?1:e.localeCompare(t,void 0,{sensitivity:"base"})});return{grouped:t,sortedCategories:s}}(e),[e]),S=e=>{t(t=>({...t,[e]:{...t[e],"enable-snippet":!t[e]?.["enable-snippet"]}}))};return(0,n.useEffect)(()=>{!z&&j.length>0&&v(j[0])},[z,j]),(0,n.useEffect)(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),g||u())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[u,g]),(0,b.jsxs)("article",{className:"zenpress-row",children:[(0,b.jsxs)("section",{className:"zenpress-main",children:[(0,b.jsx)("div",{className:"zenpress-notices",children:(0,b.jsx)(h,{})}),(0,b.jsxs)("div",{className:"zenpress-panel",children:[(0,b.jsxs)(f,{orientation:"vertical",selectedTabId:z,onSelect:v,children:[(0,b.jsx)(f.TabList,{children:j.map(e=>{const t=`zenpress-tabs__tab--category-${e.toLowerCase().replace(/\s+/g,"-")}`;return(0,b.jsx)(f.Tab,{tabId:e,title:d(e),className:t,children:d(e)},e)})}),j.map(e=>(0,b.jsx)(f.TabPanel,{tabId:e,children:(0,b.jsx)(w,{category:e,groupedSnippets:x,onToggle:S,showIntegrations:"tools"===e,adminBarEnabled:s,setAdminBarEnabled:r,autoconfigBusy:m,getAutoconfigHandler:_})},e))]}),(0,b.jsx)(y,{onEnableAll:()=>{t(e=>{const t={};return Object.keys(e).forEach(s=>{t[s]={...e[s],"enable-snippet":!0}}),t})},onDisableAll:()=>{t(e=>{const t={};return Object.keys(e).forEach(s=>{t[s]={...e[s],"enable-snippet":!1}}),t})},onSave:u,isSaving:g})]})]}),(0,b.jsx)("aside",{className:"zenpress-sidebar",children:(0,b.jsx)(A,{onEnablePreset:e=>{t(t=>{const s={};return Object.entries(t).forEach(([t,n])=>{const r=(Array.isArray(n?.preset)?n.preset:[]).includes(e);s[t]={...n,"enable-snippet":r}}),s})}})})]})};s()(()=>{const e=document.getElementById("zenpress-settings");e&&e instanceof HTMLElement&&(0,n.createRoot)(e).render((0,b.jsx)(C,{}))})})();